"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[195],{4993:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(2983);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=p(n),h=r,m=d["".concat(l,".").concat(h)]||d[h]||u[h]||s;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:r,o[1]=i;for(var p=2;p<s;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},1689:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>p});var a=n(2798),r=(n(2983),n(4993));n(886);const s={sidebar_position:1,sidebar_label:"First steps"},o="First steps",i={unversionedId:"tutorial/first-steps",id:"tutorial/first-steps",title:"First steps",description:"This library aims to manage states in general, but its power resides when using",source:"@site/docs/tutorial/first-steps.md",sourceDirName:"tutorial",slug:"/tutorial/first-steps",permalink:"/react-async-states/docs/tutorial/first-steps",draft:!1,editUrl:"https://github.com/incepter/react-async-states/edit/main/packages/docs/docs/tutorial/first-steps.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"First steps"},sidebar:"tutorialSidebar",previous:{title:"Concepts",permalink:"/react-async-states/docs/concepts"},next:{title:"State sharing",permalink:"/react-async-states/docs/tutorial/state-sharing"}},l={},p=[{value:"Fetching the users list",id:"fetching-the-users-list",level:2},{value:"Trigger the fetch on button&#39;s click",id:"trigger-the-fetch-on-buttons-click",level:3},{value:"Make it automatic on mount",id:"make-it-automatic-on-mount",level:3},{value:"Fetching the user details",id:"fetching-the-user-details",level:2},{value:"React to dependencies with condition",id:"react-to-dependencies-with-condition",level:3},{value:"Debounce search while typing",id:"debounce-search-while-typing",level:3},{value:"React to URL change",id:"react-to-url-change",level:3},{value:"Skip the pending state if request is so fast",id:"skip-the-pending-state-if-request-is-so-fast",level:3}],c={toc:p};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"first-steps"},"First steps"),(0,r.kt)("p",null,"This library aims to manage states in general, but its power resides when using\nasynchronous ones."),(0,r.kt)("p",null,"This section should let you get your hands dirty with the library, we will be\nusing ",(0,r.kt)("inlineCode",{parentName:"p"},"axios")," in our examples."),(0,r.kt)("p",null,"We will be building an application for users management, but we will go\nincrementally, so you can have an overall idea on how the library is flexible\nand its way of state management."),(0,r.kt)("p",null,"In this section you will learn how to deal with the following using the library:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Manually trigger data fetch"),(0,r.kt)("li",{parentName:"ul"},"Trigger data fetching based on dependencies"),(0,r.kt)("li",{parentName:"ul"},"Search while typing (+ concurrency & debounce)"),(0,r.kt)("li",{parentName:"ul"},"URL based automatic data fetching (via the query string)")),(0,r.kt)("p",null,"The following examples are using ",(0,r.kt)("inlineCode",{parentName:"p"},"useAsyncState")," hook."),(0,r.kt)("p",null,"You can think of its signature like"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"function useAsyncState(config, dependencies = []) {\n  // ...\n}\n")),(0,r.kt)("h2",{id:"fetching-the-users-list"},"Fetching the users list"),(0,r.kt)("h3",{id:"trigger-the-fetch-on-buttons-click"},"Trigger the fetch on button's click"),(0,r.kt)("p",null,"The following snippet should get you started to the library:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'import axios from "axios";\nimport {\n  useAsyncState,\n  UseAsyncState,\n  ProducerProps\n} from "react-async-states";\n\nconst API = axios.create({\n  baseURL: "https://jsonplaceholder.typicode.com"\n});\n\ntype User = {\n  id: number;\n  email: string;\n  name: string;\n};\n\nasync function fetchUsers(props: ProducerProps<User[], Error, undefined, never>): Promise<User[]> {\n  const controller = new AbortController();\n  props.onAbort(() => controller.abort());\n\n  const usersResponse = await API.get("/users", {signal: controller.signal});\n  return usersResponse.data;\n}\n\nexport default function App() {\n  const {state, run} = useAsyncState(fetchUsers);\n  const {status, data} = state;\n\n  return (\n    <div className="App">\n      <button onClick={() => run()}>Fetch users</button>\n      <h3>Status is: {status}</h3>\n      {status === "success" && (\n        <ul>\n          {data.map((user) => (\n            <li key={user.id}>{user.name}</li>\n          ))}\n        </ul>\n      )}\n    </div>\n  );\n}\n')),(0,r.kt)("p",null,"Here is a codesandbox demo with the previous code snippet:"),(0,r.kt)("details",{open:!0},(0,r.kt)("summary",null,"Fetching users list codesandbox demo"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-8i2sib?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})),(0,r.kt)("p",null,"This example was chosen on purpose so it may be familiar to you if you already\nknow ",(0,r.kt)("inlineCode",{parentName:"p"},"react-query")," or any other library using the same paradigm."),(0,r.kt)("h3",{id:"make-it-automatic-on-mount"},"Make it automatic on mount"),(0,r.kt)("p",null,"Let's take a close look at how we used the ",(0,r.kt)("inlineCode",{parentName:"p"},"useAsyncState")," hook in the previous\nexample:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const {state, run} = useAsyncState(fetchUsers);\n")),(0,r.kt)("p",null,"This is equivalent to its base version:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"const {state, run} = useAsyncState({\n  // highlight-next-line\n  producer: fetchUsers,\n});\n")),(0,r.kt)("p",null,"The base way to ",(0,r.kt)("inlineCode",{parentName:"p"},"useAsyncState")," hook is the use a configuration object. If\nsometimes your use case is basic, the library supported some shortcuts."),(0,r.kt)("p",null,"To make it run automatically on mount, let's mark it as ",(0,r.kt)("inlineCode",{parentName:"p"},"lazy: false"),":"),(0,r.kt)("p",null,"See it here:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Fetching users list automatically on mount codesandbox demo"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-ycq7xf?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})),(0,r.kt)("h2",{id:"fetching-the-user-details"},"Fetching the user details"),(0,r.kt)("h3",{id:"react-to-dependencies-with-condition"},"React to dependencies with condition"),(0,r.kt)("p",null,"Now, let's fetch the user details when typing his id."),(0,r.kt)("p",null,"This time, we will be:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Storing the ",(0,r.kt)("inlineCode",{parentName:"li"},"userId")," in a state variable using react's ",(0,r.kt)("inlineCode",{parentName:"li"},"useState"),"."),(0,r.kt)("li",{parentName:"ul"},"Pass the userId to our ",(0,r.kt)("inlineCode",{parentName:"li"},"producer")," in the ",(0,r.kt)("inlineCode",{parentName:"li"},"payload"),"."),(0,r.kt)("li",{parentName:"ul"},"Only fetch if the userId is ",(0,r.kt)("inlineCode",{parentName:"li"},"truthy"),"."),(0,r.kt)("li",{parentName:"ul"},"Fetch everytime the ",(0,r.kt)("inlineCode",{parentName:"li"},"userId")," changes."),(0,r.kt)("li",{parentName:"ul"},"Abort the previous call if a second is done while ",(0,r.kt)("inlineCode",{parentName:"li"},"pending"),".")),(0,r.kt)("p",null,"Here is a full working example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'async function fetchUser(props: ProducerProps<User>): Promise<User> {\n  const controller = new AbortController();\n  props.onAbort(() => controller.abort());\n\n  const {userId} = props.payload;\n\n  const usersResponse = await API.get("/users/" + userId, {\n    signal: controller.signal\n  });\n  return usersResponse.data;\n}\n\nexport default function App() {\n  const [userId, setUserId] = React.useState("");\n  const {state} = useAsyncState(\n    {\n      lazy: false,\n      condition: !!userId,\n      producer: fetchUser,\n      payload: {\n        userId\n      }\n    },\n    [userId]\n  );\n  const {status, data, props} = state;\n\n  return (\n    <div className="App">\n      <input onChange={(e) => setUserId(e.target.value)}/>\n      <h3>Status is: {status}</h3>\n      {status === "success" && (\n        <details open>\n          <pre>{JSON.stringify(data, null, 4)}</pre>\n        </details>\n      )}\n      {status === "error" && (\n        <div>\n          error while retrieving user with id: {props?.payload.userId}\n          <pre>{data.toString()}</pre>\n        </div>\n      )}\n    </div>\n  );\n}\n\n')),(0,r.kt)("p",null,"Try it here, notice the cancellation of previous requests, also, you can remove\nthe abort callback and/or the signal to make concurrency chaos, and make sure to\nobserve the consistency in the UI."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"react to dependencies change with condition codesandbox demo"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-qr44ti?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})),(0,r.kt)("h3",{id:"debounce-search-while-typing"},"Debounce search while typing"),(0,r.kt)("p",null,"If we look at the previous example, we run a fetch request whenever the user\ntypes something (and we ignore empty string)."),(0,r.kt)("p",null,"Now, let's debounce the run by ",(0,r.kt)("inlineCode",{parentName:"p"},"400ms"),":"),(0,r.kt)("p",null,"That's all we need to do it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'// ...\nexport default function App() {\n  const [userId, setUserId] = React.useState("");\n  const {state} = useAsyncState(\n    {\n      lazy: false,\n      condition: !!userId,\n      producer: fetchUser,\n      // highlight-next-line\n      runEffect: "debounce",\n      // highlight-next-line\n      runEffectDurationMs: 400,\n      payload: {\n        userId\n      }\n    },\n    [userId]\n  );\n  // ...\n}\n\n')),(0,r.kt)("p",null,"Try it here:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"debounce the run codesandbox demo"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-r2qd8q?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"run")," function supports passing parameters to the ",(0,r.kt)("inlineCode",{parentName:"p"},"producer"),", received as ",(0,r.kt)("inlineCode",{parentName:"p"},"args"),"."),(0,r.kt)("p",{parentName:"admonition"},"Let's edit the previous example and get rid of the state variable:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},'\nasync function fetchUser(props: ProducerProps<User>): Promise<User> {\n  const controller = new AbortController();\n  props.onAbort(() => controller.abort());\n\n  // highlight-next-line\n  const [userId] = props.args;\n\n  const usersResponse = await API.get("/users/" + userId, {\n    signal: controller.signal\n  });\n  return usersResponse.data;\n}\n\nexport default function App() {\n  const { run, state } = useAsyncState({\n    lazy: true,\n    producer: fetchUser,\n    runEffect: "debounce",\n    runEffectDurationMs: 400\n  });\n  const { status, data, props } = state;\n\n  return (\n    <div className="App">\n      <input onChange={(e) => run(e.target.value)} />\n      <h3>Status is: {status}</h3>\n      {status === "success" && (\n        <details open>\n          <pre>{JSON.stringify(data, null, 4)}</pre>\n        </details>\n      )}\n      {status === "error" && (\n        <div>\n          error while retrieving user with id: {props?.payload.userId}\n          <pre>{data.toString()}</pre>\n        </div>\n      )}\n    </div>\n  );\n}\n\n')),(0,r.kt)("p",{parentName:"admonition"},"See it here:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"run with userId codesandbox demo"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-dz0knu?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})),(0,r.kt)("p",{parentName:"admonition"},"Notice that we removed the state variable and also the payload and the dependency\narray."),(0,r.kt)("p",{parentName:"admonition"},"The library's default dependencies are an empty array.")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"If you take a close look at how we used ",(0,r.kt)("inlineCode",{parentName:"p"},"useAsyncState")," in the previous example,\nyou'd see that our producer does not depend from any closure related to\nthe component render:\nit can safely be moved to module level."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},'const searchUserConfig = {\n  lazy: true,\n  producer: fetchUser,\n  runEffect: "debounce",\n  runEffectDurationMs: 400\n};\n\nexport default function App() {\n  const {run, state} = useAsyncState(searchUserConfig);\n  const {status, data, props} = state;\n  // the rest\n}\n'))),(0,r.kt)("h3",{id:"react-to-url-change"},"React to URL change"),(0,r.kt)("p",null,"Now, rather than writing the user id and reacting to a state variable, let's\ngrab the ",(0,r.kt)("inlineCode",{parentName:"p"},"userId")," from the url and navigate when the typed value changes."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// highlit-next-line\nconst {userId} = useParams();\nconst {state} = useAsyncState(\n  {\n    lazy: false,\n    condition: !!userId,\n    producer: fetchUser,\n    payload: {\n      userId\n    }\n  },\n  [userId]\n);\nconst {status, data, props} = state;\n\n\n// AND\n\nconst navigate = useNavigate();\n\nfunction onChange(e) {\n  const id = e.target.value;\n  if (id) {\n    navigate(`/users/${id}`);\n  }\n}\n<input onChange={onChange} />;\n\n")),(0,r.kt)("p",null,"See it in action here:"),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Read userId from the URL codesandbox demo"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-w9v2ss?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})),(0,r.kt)("h3",{id:"skip-the-pending-state-if-request-is-so-fast"},"Skip the pending state if request is so fast"),(0,r.kt)("p",null,"To skip the pending state, the ",(0,r.kt)("inlineCode",{parentName:"p"},"skipPendingDelayMs")," is used."),(0,r.kt)("p",null,"It means that when state turns to pending, and then changes under that delay,\nthe pending update shall be skipped."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx"},"// highlit-next-line\nconst {userId} = useParams();\nconst {state} = useAsyncState(\n  {\n    lazy: false,\n    condition: !!userId,\n    producer: fetchUser,\n    skipPendingDelayMs: 400,\n    payload: {\n      userId\n    }\n  },\n  [userId]\n);\nconst {status, data, props} = state;\n\n\n// AND\n\nconst navigate = useNavigate();\n\nfunction onChange(e) {\n  const id = e.target.value;\n  if (id) {\n    navigate(`/users/${id}`);\n  }\n}\n<input onChange={onChange} />;\n\n")),(0,r.kt)("p",null,"See it in action here, and notice that when having a good internet connexion\nthat the experience feels instantaneous."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Skip the pending state"),(0,r.kt)("iframe",{style:{width:"100%",height:"500px",border:0,borderRadius:4,overflow:"hidden"},src:"https://codesandbox.io/embed/react-typescript-forked-dphucp?fontsize=14&hidenavigation=1&theme=dark",allow:"accelerometer; ambient-light-sensor; camera; encrypted-media;\ngeolocation; gyroscope; hid; microphone; midi; payment; usb; vr;\nxr-spatial-tracking",sandbox:"allow-forms allow-modals allow-popups allow-presentation\nallow-same-origin allow-scripts"})))}d.isMDXComponent=!0}}]);